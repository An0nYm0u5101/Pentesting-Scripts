#!/usr/bin/python

import socket, sys, argparse

#per user
parser = argparse.ArgumentParser(description='SMTP User Enumeration')
parser.add_argument('hostname', help='hostname to be enumerated')
parser.add_argument('-u', '--user', help='Username to enumerate. Seperate multiple usernames with commas (e.g. bob, bill, mary).')
parser.add_argument('-f', '--file', help='Filename with usernames to enumerate. Usernames must be seperated by newline.')
args = parser.parse_args()

print '-' * 78, '\n'
print 'SMTP User Enumeration v0.1 - SMTP VRFY by Jonathan Broche http://gojhonny.com'
print '-' * 78, '\n'

if args.hostname and (args.user or args.file):
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)    
    if args.file:
        if os.path.exists(args.file):            
            s.connect((socket.gethostbyname(args.hostname), 25))
            print s.recv(1024)            
            with open(args.file, 'r') as f:
                for user in f.readlines():
                    s.send('VRFY {}\r\n'.format(user))
                    if '250' in s.recv(1024):
                        print '[!] {} is a valid user'.format(user)
                    else:
                        print '[*] {} is not a valid user'.format(user)
        else:
            print '[!] Not a valid filename/path.'
    else:
        s.connect((socket.gethostbyname(args.hostname), 25))
        print s.recv(1024)
        s.send('VRFY {}\r\n'.format(args.user))
else:
    print '[!] Please provide a username or file to enumerate.'